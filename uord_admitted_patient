q#!/bin/bash
echo "Select your choice"
echo "1.Update a patient's full record"
echo "2.Delete patient's record"
read choice

if [[ "$choice" -eq 1 ]]
then
#Update code
name_regex="[^a-zA-Z0-9 ]+"
number_regex="[^0-9 ]+"
# no need to patient id, patient name and doctor id and doctor name since those are taken directly from patient and doctor table.
# so, no need to fetch that data from the user as admitted_patient_id contains all the information regarding patient and doctor 
echo "Please add the following patient details"

echo "Enter admitted patien's id"
read admitted_patient_id

echo "Enter admitted date"
read admitted_date

echo "Enter patient's location"
read location

if [[ "$location" =~ $name_regex ]]
then
echo "please enter a valid location"
exit 1
fi

echo "Enter diagnosis"
read diagnosis

#UPDATE BUILDING
# 
awk -F, -v admitted_patient_id="$admitted_patient_id" -v admitted_date="$admitted_date" -v location="$location" -v diagnosis=$diagnosis 'BEGIN {OFS=FS} {
   if($1 == admitted_patient_id) {
    $2=$2;
    $3=admitted_date;
    $4=location;
    $5=$5;
    $6=diagnosis;
    }
    }1' admitted_patients.csv > admitted_patients.tmp && mv aadmitted_patients.tmp admitted_patients.csv

echo "Admitted patients's record updated!"

elif [[ "$choice" -eq 2 ]]
then
#Delete admitted patient
echo "Enter admitted patient's id"
read admitted_patient_id
echo " Do you want to proceed with deleting admitted patient's record for ID $id(y/n)"
read c1
if [ "$c1" = y ]
then
awk -v admitted_patient_id=$admitted_patient_id -F, '$1 != admitted_patient_id' admitted_patients.csv > admitted_patients.tmp && mv admitted_patients.tmp admitted_patients.csv
echo "Record deleted!"
else
echo "Record not deleted..."
fi
#---------------------------------------------

else
echo "Incorrect Entry"
#--------------------------------------------
fi